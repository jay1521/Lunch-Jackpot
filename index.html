<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lunch Jackpot Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #ff00cc, #333399, #00ccff);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-card { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .roulette-window { height: 80px; overflow: hidden; position: relative; border-radius: 12px; background: #fff; border: 4px solid #fbbf24; }
        .roulette-belt { display: flex; flex-direction: column; align-items: center; transform: translateY(0); }
        .roulette-item { height: 80px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; color: #333; text-align: center; padding: 0 10px; width: 100%; }
        .spinning { animation: slideUp 4s cubic-bezier(0.1, 1, 0.2, 1) forwards; }
        @keyframes slideUp { 0% { transform: translateY(0); } 100% { transform: translateY(var(--scroll-distance)); } }
        .pop-in { animation: pop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .loader { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .star-btn.active { color: #f59e0b; filter: drop-shadow(0 0 5px rgba(245, 158, 11, 0.5)); }
    </style>
</head>
<body class="font-sans min-h-screen p-4 flex flex-col items-center">

    <header class="w-full max-w-md my-4 text-center text-white">
        <h1 class="text-4xl font-black mb-1 drop-shadow-lg">üé∞ Lunch Jackpot</h1>
        <div id="status-container" class="flex justify-center items-center gap-2 bg-white/20 py-1 px-4 rounded-full inline-flex backdrop-blur-sm">
            <div id="loader" class="loader hidden"></div>
            <p class="text-xs font-bold" id="location-status">Ready to hunt!</p>
        </div>
    </header>

    <main class="w-full max-w-md flex flex-col gap-4">
        
        <div class="glass-card p-4 rounded-2xl shadow-lg border border-white/50">
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div>
                    <label class="block text-[10px] font-black text-gray-400 uppercase mb-1">Zip Code</label>
                    <input type="text" id="zip-input" placeholder="Current GPS" class="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm font-bold outline-none">
                </div>
                <div>
                    <label class="block text-[10px] font-black text-gray-400 uppercase mb-1">Max Budget</label>
                    <select id="budget-input" class="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm font-bold outline-none">
                        <option value="4">Any Price</option>
                        <option value="1">$ - Cheap</option>
                        <option value="2">$$ - Mid</option>
                        <option value="3">$$$ - High</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div>
                    <label class="block text-[10px] font-black text-gray-400 uppercase mb-1">Cuisine</label>
                    <select id="cuisine-input" class="w-full p-2 bg-white border border-gray-200 rounded-lg text-[11px] font-bold outline-none">
                        <option value="all">üé° Everything</option>
                        <option value="pizza">üçï Pizza</option>
                        <option value="burger">üçî Burgers</option>
                        <option value="mexican">üåÆ Mexican</option>
                        <option value="asian">üç£ Asian</option>
                    </select>
                </div>
                <div class="flex flex-col justify-end pb-1">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="open-now-check" class="w-4 h-4 accent-pink-600">
                        <span class="text-[10px] font-black text-gray-600 uppercase">Open Now</span>
                    </label>
                </div>
            </div>
            <button id="search-btn" class="w-full bg-slate-800 text-white text-xs font-black py-2.5 rounded-lg shadow-md">REFRESH LIST</button>
        </div>

        <div class="glass-card p-6 rounded-2xl shadow-2xl text-center relative">
            <div id="roulette-area" class="mb-6 hidden">
                <div class="roulette-window"><div id="roulette-belt" class="roulette-belt"></div></div>
            </div>

            <div id="final-result-card" class="hidden mb-6 p-5 bg-gradient-to-br from-yellow-50 to-white rounded-xl border-4 border-yellow-400 shadow-xl">
                <h2 id="winner-name" class="text-2xl font-black text-gray-900 leading-tight mb-1">--</h2>
                <div id="winner-rating" class="text-orange-500 font-bold text-sm mb-2"></div>
                <p id="winner-details" class="text-gray-600 text-xs font-bold mb-4">--</p>
                <div class="flex flex-col gap-2">
                    <a id="maps-link" href="#" target="_blank" class="block bg-indigo-600 text-white text-xs font-black py-3 px-6 rounded-full shadow-lg">üó∫Ô∏è GET DIRECTIONS</a>
                    <button id="share-btn" class="block bg-emerald-500 text-white text-xs font-black py-3 px-6 rounded-full shadow-lg">üì§ TEXT TO FRIENDS</button>
                </div>
            </div>

            <button id="pick-btn" disabled class="w-full bg-gradient-to-r from-pink-600 to-purple-700 text-white font-black py-4 px-6 rounded-xl text-xl shadow-lg transition-all active:scale-95 disabled:opacity-50">
                üé≤ SPIN THE WHEEL
            </button>
        </div>

        <div class="glass-card p-5 rounded-2xl shadow-xl">
            <h3 class="text-sm font-black text-gray-400 uppercase mb-4 tracking-widest">Nearby Contenders</h3>
            <div id="restaurant-list" class="flex flex-col gap-3 max-h-80 overflow-y-auto"></div>
        </div>
    </main>

    <script>
        const listContainer = document.getElementById('restaurant-list');
        const locationStatus = document.getElementById('location-status');
        const loader = document.getElementById('loader');
        const pickBtn = document.getElementById('pick-btn');
        const searchBtn = document.getElementById('search-btn');
        const shareBtn = document.getElementById('share-btn');
        const zipInput = document.getElementById('zip-input');
        const budgetInput = document.getElementById('budget-input');
        const cuisineInput = document.getElementById('cuisine-input');
        const openNowCheck = document.getElementById('open-now-check');
        const rouletteArea = document.getElementById('roulette-area');
        const rouletteBelt = document.getElementById('roulette-belt');
        const finalResultCard = document.getElementById('final-result-card');
        
        let availableRestaurants = [];
        let userLat = 0, userLon = 0;
        let favorites = JSON.parse(localStorage.getItem('lunchJackpotFavs') || '[]');
        let currentWinner = null;

        function toggleFavorite(id) {
            const index = favorites.indexOf(id);
            if (index > -1) favorites.splice(index, 1);
            else favorites.push(id);
            localStorage.setItem('lunchJackpotFavs', JSON.stringify(favorites));
            renderList(availableRestaurants);
        }

        async function startSearch() {
            loader.classList.remove('hidden');
            locationStatus.textContent = "Locating...";
            finalResultCard.classList.add('hidden');
            try {
                if (zipInput.value.trim() !== "") {
                    const resp = await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zipInput.value.trim()}&country=US&format=json`);
                    const data = await resp.json();
                    userLat = parseFloat(data[0].lat); userLon = parseFloat(data[0].lon);
                } else {
                    const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej));
                    userLat = pos.coords.latitude; userLon = pos.coords.longitude;
                }
                fetchRestaurants();
            } catch (e) { alert("GPS Denied"); loader.classList.add('hidden'); }
        }

        async function fetchRestaurants() {
            const query = `[out:json];(node["amenity"~"restaurant|fast_food"](around:5000,${userLat},${userLon}););out 50;`;
            try {
                const response = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`);
                const data = await response.json();
                availableRestaurants = data.elements
                    .filter(place => place.tags && place.tags.name)
                    .map(place => ({
                        id: place.id.toString(),
                        name: place.tags.name,
                        type: (place.tags.cuisine || 'Food').split(';')[0].toUpperCase(),
                        priceLevel: (place.tags.amenity === 'fast_food') ? 1 : 2,
                        distance: calculateMiles(userLat, userLon, place.lat, place.lon),
                        lat: place.lat, lon: place.lon
                    }))
                    .sort((a, b) => a.distance - b.distance);
                renderList(availableRestaurants);
                pickBtn.disabled = false;
                loader.classList.add('hidden');
            } catch (err) { loader.classList.add('hidden'); }
        }

        function renderList(data) {
            listContainer.innerHTML = data.map(p => `
                <div class="flex justify-between items-center p-3 bg-white/70 rounded-xl border border-white">
                    <div class="w-3/5"><h4 class="font-bold text-gray-800 text-xs truncate">${p.name}</h4><p class="text-[9px] text-gray-400 font-black uppercase">${p.type} ‚Ä¢ ${p.distance}mi</p></div>
                    <button onclick="toggleFavorite('${p.id}')" class="star-btn text-xl ${favorites.includes(p.id) ? 'active' : 'text-gray-300'}">${favorites.includes(p.id) ? '‚òÖ' : '‚òÜ'}</button>
                </div>`).join('');
        }

        pickBtn.addEventListener('click', () => {
            rouletteArea.classList.remove('hidden');
            rouletteBelt.innerHTML = '';
            currentWinner = availableRestaurants[Math.floor(Math.random() * availableRestaurants.length)];
            let items = [];
            for(let i=0; i<15; i++) items.push(`<div class="roulette-item truncate px-4">${availableRestaurants[i % availableRestaurants.length].name}</div>`);
            items.push(`<div class="roulette-item text-pink-600 font-black">${currentWinner.name}</div>`);
            rouletteBelt.innerHTML = items.join('');
            document.documentElement.style.setProperty('--scroll-distance', `-${(items.length - 1) * 80}px`);
            setTimeout(() => {
                rouletteBelt.classList.add('spinning');
                rouletteBelt.addEventListener('animationend', () => {
                    rouletteArea.classList.add('hidden');
                    document.getElementById('winner-name').innerText = currentWinner.name;
                    document.getElementById('winner-details').innerText = `${currentWinner.type} ‚Ä¢ ${currentWinner.distance} MILES`;
                    document.getElementById('maps-link').href = `https://www.google.com/maps?q=${currentWinner.lat},${currentWinner.lon}`;
                    finalResultCard.classList.remove('hidden');
                }, {once: true});
            }, 50);
        });

        // --- THE SOCIAL SHARE FEATURE ---
        shareBtn.addEventListener('click', async () => {
            if (!currentWinner) return;
            const shareData = {
                title: 'Lunch Jackpot!',
                text: `I just won the Lunch Jackpot! Let's go to ${currentWinner.name} (${currentWinner.type}).`,
                url: `https://www.google.com/maps?q=${currentWinner.lat},${currentWinner.lon}`
            };
            try {
                if (navigator.share) { await navigator.share(shareData); } 
                else { alert("Share not supported on this browser. Copy the URL manually!"); }
            } catch (err) { console.log(err); }
        });

        function calculateMiles(lat1, lon1, lat2, lon2) {
            const R = 3958.8; const dLat = (lat2-lat1)*Math.PI/180; const dLon = (lon2-lon1)*Math.PI/180;
            const a = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);
            return (R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)))).toFixed(1);
        }
        searchBtn.addEventListener('click', startSearch);
    </script>
</body>
</html>
