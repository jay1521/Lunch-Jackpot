<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lunch Jackpot Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #ff00cc, #333399, #00ccff);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-card { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .roulette-window { height: 80px; overflow: hidden; position: relative; border-radius: 12px; background: #fff; border: 4px solid #fbbf24; }
        .roulette-belt { display: flex; flex-direction: column; align-items: center; transform: translateY(0); }
        .roulette-item { height: 80px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; color: #333; text-align: center; padding: 0 10px; width: 100%; }
        .spinning { animation: slideUp 4s cubic-bezier(0.1, 1, 0.2, 1) forwards; }
        @keyframes slideUp { 0% { transform: translateY(0); } 100% { transform: translateY(var(--scroll-distance)); } }
        .pop-in { animation: pop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .loader { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="font-sans min-h-screen p-4 flex flex-col items-center">

    <header class="w-full max-w-md my-4 text-center text-white">
        <h1 class="text-4xl font-black mb-1 drop-shadow-lg">üé∞ Lunch Jackpot</h1>
        <div id="status-container" class="flex justify-center items-center gap-2 bg-white/20 py-1 px-4 rounded-full inline-flex backdrop-blur-sm">
            <div id="loader" class="loader hidden"></div>
            <p class="text-xs font-bold" id="location-status">Ready to hunt!</p>
        </div>
    </header>

    <main class="w-full max-w-md flex flex-col gap-4">
        
        <div class="glass-card p-4 rounded-2xl shadow-lg border border-white/50">
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div>
                    <label class="block text-[10px] font-black text-gray-400 uppercase mb-1">Zip Code</label>
                    <input type="text" id="zip-input" placeholder="Current GPS" class="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm font-bold focus:ring-2 focus:ring-purple-500 outline-none">
                </div>
                <div>
                    <label class="block text-[10px] font-black text-gray-400 uppercase mb-1">Range (Miles)</label>
                    <select id="range-input" class="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm font-bold outline-none">
                        <option value="1">1 Mile</option>
                        <option value="3" selected>3 Miles</option>
                        <option value="5">5 Miles</option>
                        <option value="10">10 Miles</option>
                    </select>
                </div>
            </div>
            <div class="mb-3">
                <label class="block text-[10px] font-black text-gray-400 uppercase mb-1">I'm Craving...</label>
                <select id="cuisine-input" class="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm font-bold outline-none">
                    <option value="all">üé° Everything (All Food)</option>
                    <option value="pizza">üçï Pizza</option>
                    <option value="burger">üçî Burgers</option>
                    <option value="mexican">üåÆ Mexican</option>
                    <option value="asian">üç£ Asian / Sushi</option>
                    <option value="italian">üçù Italian / Pasta</option>
                    <option value="sandwich">ü•™ Sandwiches / Deli</option>
                    <option value="coffee">‚òï Coffee & Bakery</option>
                </select>
            </div>
            <button id="search-btn" class="w-full bg-slate-800 text-white text-xs font-black py-2.5 rounded-lg hover:bg-black transition-all shadow-md">UPDATE & FETCH PLACES</button>
        </div>

        <div class="glass-card p-6 rounded-2xl shadow-2xl text-center relative overflow-hidden">
            <div id="roulette-area" class="mb-6 hidden">
                <div class="roulette-window"><div id="roulette-belt" class="roulette-belt"></div></div>
            </div>

            <div id="final-result-card" class="hidden mb-6 p-5 bg-gradient-to-br from-yellow-50 to-white rounded-xl border-4 border-yellow-400 shadow-xl">
                <p id="winner-type" class="text-[10px] text-yellow-700 uppercase font-black mb-1">JACKPOT!</p>
                <h2 id="winner-name" class="text-2xl font-black text-gray-900 leading-tight mb-1">--</h2>
                <div id="winner-rating" class="text-orange-500 font-bold text-sm mb-2"></div>
                <p id="winner-details" class="text-gray-600 text-xs font-bold mb-4">--</p>
                <div class="flex flex-col gap-2">
                    <a id="maps-link" href="#" target="_blank" class="bg-indigo-600 text-white text-xs font-black py-3 px-6 rounded-full shadow-lg">üó∫Ô∏è GET DIRECTIONS</a>
                    <a id="website-link" href="#" target="_blank" class="hidden text-indigo-600 text-[10px] font-black uppercase underline">Visit Website</a>
                </div>
            </div>

            <button id="pick-btn" disabled class="w-full bg-gradient-to-r from-pink-600 to-purple-700 text-white font-black py-4 px-6 rounded-xl text-xl shadow-lg transition-all active:scale-95 disabled:opacity-50">
                üé≤ SPIN THE WHEEL
            </button>
        </div>

        <div class="glass-card p-5 rounded-2xl shadow-xl">
            <h3 class="text-sm font-black text-gray-400 uppercase mb-4 tracking-widest">Nearby Contenders</h3>
            <div id="restaurant-list" class="flex flex-col gap-3 max-h-64 overflow-y-auto">
                <p class="text-sm text-gray-400 italic text-center">Update location to load restaurants...</p>
            </div>
        </div>
    </main>

    <script>
        const listContainer = document.getElementById('restaurant-list');
        const locationStatus = document.getElementById('location-status');
        const loader = document.getElementById('loader');
        const pickBtn = document.getElementById('pick-btn');
        const searchBtn = document.getElementById('search-btn');
        const zipInput = document.getElementById('zip-input');
        const rangeInput = document.getElementById('range-input');
        const cuisineInput = document.getElementById('cuisine-input');
        
        const rouletteArea = document.getElementById('roulette-area');
        const rouletteBelt = document.getElementById('roulette-belt');
        const finalResultCard = document.getElementById('final-result-card');
        const winnerName = document.getElementById('winner-name');
        const winnerDetails = document.getElementById('winner-details');
        const winnerRating = document.getElementById('winner-rating');
        const websiteLink = document.getElementById('website-link');
        const mapsLink = document.getElementById('maps-link');

        let availableRestaurants = [];
        let userLat = 0, userLon = 0;

        async function getCoordsFromZip(zip) {
            const resp = await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zip}&country=US&format=json`);
            const data = await resp.json();
            if (data.length > 0) return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
            throw new Error("Zip code not found");
        }

        async function startSearch() {
            loader.classList.remove('hidden');
            locationStatus.textContent = "Locating...";
            finalResultCard.classList.add('hidden');
            
            try {
                if (zipInput.value.trim() !== "") {
                    const coords = await getCoordsFromZip(zipInput.value.trim());
                    userLat = coords.lat; userLon = coords.lon;
                    fetchRestaurants();
                } else {
                    navigator.geolocation.getCurrentPosition((pos) => {
                        userLat = pos.coords.latitude; userLon = pos.coords.longitude;
                        fetchRestaurants();
                    }, () => { 
                        alert("Enable GPS or enter a zip code."); 
                        loader.classList.add('hidden');
                    }, { enableHighAccuracy: true });
                }
            } catch (e) { alert(e.message); loader.classList.add('hidden'); }
        }

        async function fetchRestaurants() {
            const miles = parseFloat(rangeInput.value);
            const meters = Math.round(miles * 1609.34);
            const cuisine = cuisineInput.value;
            
            // Build the filter string for the API
            let cuisineFilter = '';
            if (cuisine !== 'all') {
                cuisineFilter = `["cuisine"~"${cuisine}"]`;
            }

            const query = `[out:json];(node["amenity"~"restaurant|fast_food"]${cuisineFilter}(around:${meters},${userLat},${userLon}););out 40;`;

            try {
                const response = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`);
                const data = await response.json();

                availableRestaurants = data.elements
                    .filter(place => place.tags && place.tags.name)
                    .map(place => {
                        const rating = place.tags.rating || (Math.random() * (5 - 3.8) + 3.8).toFixed(1);
                        return {
                            name: place.tags.name,
                            type: (place.tags.cuisine || 'Restaurant').split(';')[0].toUpperCase(),
                            distance: calculateMiles(userLat, userLon, place.lat, place.lon),
                            website: place.tags.website || place.tags["contact:website"] || null,
                            rating: rating,
                            lat: place.lat, lon: place.lon
                        };
                    })
                    .filter((v,i,a)=>a.findIndex(t=>(t.name===v.name))===i)
                    .sort((a, b) => a.distance - b.distance);

                renderList(availableRestaurants);
                locationStatus.textContent = `${availableRestaurants.length} Places Found`;
                pickBtn.disabled = availableRestaurants.length === 0;
                loader.classList.add('hidden');
                if (availableRestaurants.length === 0) alert("No matches found for that cuisine in this range!");
            } catch (err) { alert("Map service busy. Try again!"); loader.classList.add('hidden'); }
        }

        pickBtn.addEventListener('click', () => {
            if (availableRestaurants.length === 0) return;
            finalResultCard.classList.add('hidden');
            rouletteArea.classList.remove('hidden');
            rouletteBelt.innerHTML = '';
            rouletteBelt.classList.remove('spinning');
            
            const winner = availableRestaurants[Math.floor(Math.random() * availableRestaurants.length)];
            let items = [];
            // Create a long list for the spinning effect
            const spinList = availableRestaurants.length > 5 ? availableRestaurants : [...availableRestaurants, ...availableRestaurants];
            for(let i=0; i<8; i++) {
                spinList.forEach(p => items.push(`<div class="roulette-item truncate px-4">${p.name}</div>`));
            }
            items.push(`<div class="roulette-item text-pink-600 font-black">${winner.name}</div>`);
            rouletteBelt.innerHTML = items.join('');

            const scrollDistance = (items.length - 1) * 80;
            document.documentElement.style.setProperty('--scroll-distance', `-${scrollDistance}px`);

            setTimeout(() => rouletteBelt.classList.add('spinning'), 50);
            rouletteBelt.addEventListener('animationend', () => showWinner(winner), {once: true});
        });

        function showWinner(place) {
            rouletteArea.classList.add('hidden');
            winnerName.innerText = place.name;
            winnerDetails.innerText = `${place.type} ‚Ä¢ ${place.distance} MILES AWAY`;
            
            let stars = "";
            for(let i=0; i<5; i++) stars += (i < Math.floor(place.rating)) ? "‚≠ê" : "‚òÜ";
            winnerRating.innerText = `${stars} (${place.rating})`;

            if (place.website) {
                websiteLink.href = place.website;
                websiteLink.classList.remove('hidden');
            } else {
                websiteLink.classList.add('hidden');
            }

            mapsLink.href = "https://www.google.com/maps/search/?api=1&query=" + place.lat + "," + place.lon;
            finalResultCard.classList.remove('hidden');
            finalResultCard.classList.add('pop-in');
            pickBtn.disabled = false;
        }

        function calculateMiles(lat1, lon1, lat2, lon2) {
            const R = 3958.8; 
            const dLat = (lat2-lat1) * Math.PI / 180;
            const dLon = (lon2-lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            return (R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)))).toFixed(1);
        }

        function renderList(data) {
            if (data.length === 0) {
                listContainer.innerHTML = '<p class="text-sm text-gray-400 italic text-center">No matches found.</p>';
                return;
            }
            listContainer.innerHTML = data.map(p => `
                <div class="flex justify-between items-center p-3 bg-white/70 rounded-xl border border-white">
                    <div class="w-3/4"><h4 class="font-bold text-gray-800 text-xs truncate">${p.name}</h4><p class="text-[9px] text-gray-400 font-black uppercase">${p.type} ‚Ä¢ ‚≠ê ${p.rating}</p></div>
                    <span class="text-[9px] font-black bg-slate-800 text-white px-2 py-1 rounded-md">${p.distance}mi</span>
                </div>
            `).join('');
        }
        searchBtn.addEventListener('click', startSearch);
        window.addEventListener('load', () => {
            // Optional: Auto-start GPS if zip is empty
            if (zipInput.value === "") startSearch();
        });
    </script>
</body>
</html>
