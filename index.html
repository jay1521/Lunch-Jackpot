<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lunch Jackpot Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #ff00cc, #333399, #00ccff);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .glass-card { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .roulette-window { height: 80px; overflow: hidden; position: relative; border-radius: 12px; background: #fff; border: 4px solid #fbbf24; }
        .roulette-belt { display: flex; flex-direction: column; align-items: center; transform: translateY(0); }
        .roulette-item { height: 80px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; color: #333; text-align: center; padding: 0 10px; width: 100%; }
        .spinning { animation: slideUp 4s cubic-bezier(0.1, 1, 0.2, 1) forwards; }
        @keyframes slideUp { 0% { transform: translateY(0); } 100% { transform: translateY(var(--scroll-distance)); } }
        .pop-in { animation: pop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
        @keyframes pop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .loader { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid white; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        input { -webkit-appearance: none; border-radius: 8px; }
    </style>
</head>
<body class="font-sans min-h-screen p-4 flex flex-col items-center pb-20">

    <header class="w-full max-w-md my-4 text-center text-white">
        <h1 class="text-4xl font-black mb-1 drop-shadow-lg">üé∞ Lunch Jackpot</h1>
        <div class="flex justify-center items-center gap-2 bg-white/20 py-1 px-4 rounded-full inline-flex backdrop-blur-sm">
            <div id="loader" class="loader hidden"></div>
            <p class="text-xs font-bold" id="location-status">Ready to hunt!</p>
        </div>
    </header>

    <main class="w-full max-w-md flex flex-col gap-6">
        
        <div class="glass-card p-4 rounded-2xl shadow-lg border border-white/50">
            <h3 class="text-[10px] font-black text-purple-600 uppercase mb-3 tracking-widest">Find Where to Eat</h3>
            <div class="grid grid-cols-2 gap-3 mb-3">
                <input type="text" id="zip-input" placeholder="Zip (or leave for GPS)" class="p-2 bg-white border border-gray-200 rounded-lg text-xs font-bold outline-none">
                <select id="budget-input" class="p-2 bg-white border border-gray-200 rounded-lg text-xs font-bold outline-none">
                    <option value="4">Any Budget</option>
                    <option value="1">$ Cheap</option>
                    <option value="2">$$ Mid</option>
                    <option value="3">$$$ High</option>
                </select>
            </div>
            <button id="search-btn" class="w-full bg-slate-800 text-white text-xs font-black py-2.5 rounded-lg shadow-md mb-4">FETCH PLACES</button>

            <div id="roulette-area" class="hidden"><div class="roulette-window"><div id="roulette-belt" class="roulette-belt"></div></div></div>
            
            <div id="final-result-card" class="hidden p-4 bg-white rounded-xl border-4 border-yellow-400 shadow-xl pop-in">
                <h2 id="winner-name" class="text-xl font-black text-gray-900 leading-tight">--</h2>
                <div id="winner-rating" class="text-orange-500 font-bold text-xs my-1"></div>
                <p id="winner-details" class="text-gray-500 text-[10px] font-bold mb-3 uppercase">--</p>
                <div class="flex flex-col gap-2">
                    <a id="maps-link" href="#" target="_blank" class="bg-indigo-600 text-white text-[10px] font-black py-2 text-center rounded-full uppercase">üó∫Ô∏è Directions</a>
                    <a id="website-link" href="#" target="_blank" class="text-indigo-600 text-[10px] font-black text-center underline uppercase">Visit Website</a>
                </div>
            </div>
            <button id="pick-btn" disabled class="w-full mt-4 bg-gradient-to-r from-pink-600 to-purple-700 text-white font-black py-4 rounded-xl text-lg shadow-lg">üé≤ SPIN FOR FOOD</button>
        </div>

        <div class="glass-card p-5 rounded-2xl shadow-xl border border-white/50">
            <h3 class="text-[10px] font-black text-emerald-600 uppercase mb-3 tracking-widest">Bill Management</h3>
            
            <div class="bg-emerald-50 p-3 rounded-lg mb-4 border border-emerald-100">
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="number" id="bill-total" placeholder="Total Bill $" class="p-2 border border-gray-200 rounded-lg text-xs font-bold bg-white">
                    <select id="tip-percent" class="p-2 border border-gray-200 rounded-lg text-xs font-bold bg-white">
                        <option value="0.15">15% Tip</option>
                        <option value="0.18" selected>18% Tip</option>
                        <option value="0.20">20% Tip</option>
                        <option value="0.25">25% Tip</option>
                    </select>
                </div>
                <div id="split-result" class="text-center text-emerald-800 text-[11px] font-black uppercase">Enter bill to see split</div>
            </div>

            <div id="names-container" class="grid grid-cols-2 gap-2 mb-3">
                <input type="text" placeholder="Name 1" class="pay-name p-2 border border-gray-200 rounded-lg text-xs font-bold bg-white">
                <input type="text" placeholder="Name 2" class="pay-name p-2 border border-gray-200 rounded-lg text-xs font-bold bg-white">
            </div>
            <div class="flex gap-2 mb-4">
                <button onclick="addNameField()" class="flex-1 bg-gray-100 text-[10px] font-black py-2 rounded-lg text-gray-600">+ ADD PERSON</button>
                <button onclick="resetNames()" class="flex-1 bg-gray-100 text-[10px] font-black py-2 rounded-lg text-gray-600">RESET</button>
            </div>
            
            <div id="payer-display" class="hidden mb-4 p-4 bg-emerald-600 text-white rounded-xl text-center pop-in">
                <p class="text-[9px] font-black uppercase opacity-80">The Tab Winner Is:</p>
                <h2 id="payer-name" class="text-2xl font-black">--</h2>
            </div>

            <button onclick="spinForPayer()" class="w-full bg-emerald-600 text-white font-black py-4 rounded-xl text-lg shadow-lg">üí∏ SPIN FOR BILL</button>
        </div>

    </main>

    <script>
        const listContainer = document.getElementById('restaurant-list');
        const loader = document.getElementById('loader');
        const pickBtn = document.getElementById('pick-btn');
        const searchBtn = document.getElementById('search-btn');
        const rouletteArea = document.getElementById('roulette-area');
        const rouletteBelt = document.getElementById('roulette-belt');
        const finalResultCard = document.getElementById('final-result-card');
        const billInput = document.getElementById('bill-total');
        const tipInput = document.getElementById('tip-percent');
        const splitDisplay = document.getElementById('split-result');
        
        let availableRestaurants = [];
        let userLat, userLon;

        // Bill Splitting Logic
        function updateSplit() {
            const names = Array.from(document.querySelectorAll('.pay-name')).map(i => i.value.trim()).filter(n => n !== "").length;
            const total = parseFloat(billInput.value) || 0;
            const tip = parseFloat(tipInput.value);
            if (total > 0 && names > 0) {
                const grandTotal = total * (1 + tip);
                const perPerson = grandTotal / names;
                splitDisplay.innerText = `Total: $${grandTotal.toFixed(2)} | $${perPerson.toFixed(2)} Each`;
            } else {
                splitDisplay.innerText = "Add Names & Total to Split";
            }
        }
        [billInput, tipInput].forEach(el => el.addEventListener('input', updateSplit));

        // Name Management
        function addNameField() {
            const container = document.getElementById('names-container');
            if (container.children.length >= 10) return;
            const input = document.createElement('input');
            input.className = "pay-name p-2 border border-gray-200 rounded-lg text-xs font-bold bg-white";
            input.placeholder = `Name ${container.children.length + 1}`;
            input.addEventListener('input', updateSplit);
            container.appendChild(input);
            updateSplit();
        }

        function resetNames() {
            document.getElementById('names-container').innerHTML = `
                <input type="text" placeholder="Name 1" class="pay-name p-2 border border-gray-200 rounded-lg text-xs font-bold bg-white">
                <input type="text" placeholder="Name 2" class="pay-name p-2 border border-gray-200 rounded-lg text-xs font-bold bg-white">
            `;
            document.getElementById('payer-display').classList.add('hidden');
            updateSplit();
        }

        async function startSearch() {
            loader.classList.remove('hidden');
            try {
                const zip = document.getElementById('zip-input').value.trim();
                if (zip) {
                    const resp = await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${zip}&country=US&format=json`);
                    const data = await resp.json();
                    userLat = data[0].lat; userLon = data[0].lon;
                } else {
                    const pos = await new Promise((res, rej) => navigator.geolocation.getCurrentPosition(res, rej));
                    userLat = pos.coords.latitude; userLon = pos.coords.longitude;
                }
                fetchPlaces();
            } catch (e) { alert("Enable Location Access"); loader.classList.add('hidden'); }
        }

        async function fetchPlaces() {
            const query = `[out:json];(node["amenity"~"restaurant|fast_food"](around:5000,${userLat},${userLon}););out 30;`;
            const resp = await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`);
            const data = await resp.json();
            
            availableRestaurants = data.elements.filter(e => e.tags.name).map(e => ({
                name: e.tags.name,
                rating: e.tags.rating || (Math.random() * 1.2 + 3.8).toFixed(1),
                website: e.tags.website || e.tags['contact:website'] || null,
                type: (e.tags.cuisine || 'Restaurant').toUpperCase(),
                lat: e.lat, lon: e.lon
            }));
            
            pickBtn.disabled = false;
            loader.classList.add('hidden');
            document.getElementById('location-status').innerText = "Found " + availableRestaurants.length + " Options";
        }

        function spinForPayer() {
            const names = Array.from(document.querySelectorAll('.pay-name')).map(i => i.value.trim()).filter(n => n !== "");
            if (names.length < 2) return alert("Enter at least 2 names!");
            
            const display = document.getElementById('payer-display');
            const nameTarget = document.getElementById('payer-name');
            display.classList.remove('hidden');
            
            let i = 0;
            const interval = setInterval(() => {
                nameTarget.innerText = names[Math.floor(Math.random() * names.length)];
                if (i++ > 25) {
                    clearInterval(interval);
                    nameTarget.innerText = names[Math.floor(Math.random() * names.length)];
                }
            }, 60);
        }

        pickBtn.addEventListener('click', () => {
            rouletteArea.classList.remove('hidden');
            finalResultCard.classList.add('hidden');
            rouletteBelt.innerHTML = '';
            const winner = availableRestaurants[Math.floor(Math.random() * availableRestaurants.length)];
            let scrollItems = "";
            for(let i=0; i<20; i++) scrollItems += `<div class="roulette-item">${availableRestaurants[i % availableRestaurants.length].name}</div>`;
            scrollItems += `<div class="roulette-item text-pink-600 font-black">${winner.name}</div>`;
            rouletteBelt.innerHTML = scrollItems;
            
            document.documentElement.style.setProperty('--scroll-distance', `-${20 * 80}px`);
            rouletteBelt.classList.add('spinning');
            
            rouletteBelt.addEventListener('animationend', () => {
                rouletteArea.classList.add('hidden');
                rouletteBelt.classList.remove('spinning');
                document.getElementById('winner-name').innerText = winner.name;
                document.getElementById('winner-rating').innerText = "‚≠ê".repeat(Math.floor(winner.rating)) + ` (${winner.rating})`;
                document.getElementById('winner-details').innerText = winner.type;
                document.getElementById('maps-link').href = `https://www.google.com/maps?q=${winner.lat},${winner.lon}`;
                
                const web = document.getElementById('website-link');
                if (winner.website) { web.href = winner.website; web.classList.remove('hidden'); }
                else { web.classList.add('hidden'); }
                
                finalResultCard.classList.remove('hidden');
            }, {once: true});
        });

        searchBtn.addEventListener('click', startSearch);
    </script>
</body>
</html>
